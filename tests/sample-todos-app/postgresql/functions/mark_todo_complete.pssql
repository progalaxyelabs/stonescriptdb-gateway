CREATE OR REPLACE FUNCTION mark_todo_complete(
    p_todo_id INT,
    p_user_id INT,
    p_is_completed BOOLEAN DEFAULT TRUE
)
RETURNS INT AS $$
DECLARE
    v_rows_affected INT;
BEGIN
    UPDATE todos
    SET
        is_completed = p_is_completed,
        updated_on = NOW()
    WHERE todo_id = p_todo_id
      AND user_id = p_user_id;

    GET DIAGNOSTICS v_rows_affected = ROW_COUNT;
    RETURN v_rows_affected;
END;
$$ LANGUAGE plpgsql;
